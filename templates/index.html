<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="{% static "css/index.css" %}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript" src="{% static "javascript/index.js" %}"></script>
  </head>
  <body>
    <section style="background-color: #fff">
      <div class="container py-5">
        <div class="row d-flex justify-content-center">
          <div class="col-md-10 col-lg-8 col-xl-6">
            <div class="card" id="chat2">
              <div
                class="card-header d-flex justify-content-between align-items-center p-3"
              >
                <h5 class="mb-0">Chat</h5>
                <button
                  type="button"
                  class="btn btn-primary btn-sm"
                  data-mdb-ripple-color="dark"
                >
                  Let's Chat App
                </button>
              </div>
              <div
                class="card-body scrollbar scrollbar-primary chatboxdiv"
                data-perfect-scrollbar="true"
                style="position: relative; height: 400px; overflow-y: scroll" id="chatbody"
              >
                <!-- <div class="d-flex flex-row justify-content-start">
                  <img
                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
                    alt="avatar 1"
                    style="width: 45px; height: 100%"
                  />
                  <div>
                    <p
                      class="small p-2 ms-3 mb-1 rounded-3"
                      style="background-color: #f5f6f7"
                    >
                      Hi
                    </p>
                    <p
                      class="small p-2 ms-3 mb-1 rounded-3"
                      style="background-color: #f5f6f7"
                    >
                      How are you ...???
                    </p>
                    <p
                      class="small p-2 ms-3 mb-1 rounded-3"
                      style="background-color: #f5f6f7"
                    >
                      What are you doing tomorrow? Can we come up a bar?
                    </p>
                    <p class="small ms-3 mb-3 rounded-3 text-muted">23:58</p>
                  </div>
                </div> -->

                <!-- <div class="divider d-flex align-items-center mb-4">
                  <p class="text-center mx-3 mb-0" style="color: #a2aab7">
                    Today
                  </p>
                </div> -->


                <!-- multichat -->
                <!-- <div class="d-flex flex-row justify-content-end mb-4 pt-1">
                  <div>
                    <p
                      class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary"
                    >
                      Hiii, I'm good.
                    </p>
                    <p
                      class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary"
                    >
                      How are you doing?
                    </p>
                    <p
                      class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary"
                    >
                      Long time no see! Tomorrow office. will be free on sunday.
                    </p>
                  </div>
                  <img
                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava4-bg.webp"
                    alt="avatar 1"
                    style="width: 45px; height: 100%"
                  />
                </div> -->
                <!-- multichat -->

                <!-- <div class="d-flex flex-row justify-content-start mb-4">
                  <img
                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
                    alt="avatar 1"
                    style="width: 45px; height: 100%"
                  />
                  <div>
                    <p
                      class="small p-2 ms-3 mb-1 rounded-3"
                      style="background-color: #f5f6f7"
                    >
                      Okay
                    </p>
                    <p
                      class="small p-2 ms-3 mb-1 rounded-3"
                      style="background-color: #f5f6f7"
                    >
                      We will go on Sunday?
                    </p>
                    <p class="small ms-3 mb-3 rounded-3 text-muted">00:07</p>
                  </div>
                </div> -->

                <!-- <div class="d-flex flex-row justify-content-end mb-4">
                  <div>
                    <p
                      class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary"
                    >
                      That's awesome!
                    </p>
                    <p
                      class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary"
                    >
                      I will meet you Sandon Square sharp at 10 AM
                    </p>
                    <p
                      class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary"
                    >
                      Is that okay?
                    </p>
                    <p
                      class="small me-3 mb-3 rounded-3 text-muted d-flex justify-content-end"
                    >
                      00:09
                    </p>
                  </div>
                  <img
                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava4-bg.webp"
                    alt="avatar 1"
                    style="width: 45px; height: 100%"
                  />
                </div> -->

                <!-- <div class="d-flex flex-row justify-content-start mb-4 botmessagediv">
                  <img
                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
                    alt="avatar 1"
                    style="width: 45px; height: 100%"
                  />
                  <div>
                    <p
                      class="small p-2 ms-3 mb-1 rounded-3"
                      style="background-color: #f5f6f7"
                    >
                      Okay i will meet you on Sandon Square
                    </p>
                  </div>
                </div> -->

                <!-- <div class="d-flex flex-row justify-content-end mb-4">
                  <div>
                    <p
                      class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary"
                    >
                      Do you have pictures of Matley Marriage?
                    </p>
                    <p
                      class="small me-3 mb-3 rounded-3 text-muted d-flex justify-content-end"
                    >
                      00:11
                    </p>
                  </div>
                  <img
                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava4-bg.webp"
                    alt="avatar 1"
                    style="width: 45px; height: 100%"
                  />
                </div> -->

                <!-- <div class="d-flex flex-row justify-content-start mb-4">
                  <img
                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
                    alt="avatar 1"
                    style="width: 45px; height: 100%"
                  />
                  <div>
                    <p
                      class="small p-2 ms-3 mb-1 rounded-3"
                      style="background-color: #f5f6f7"
                    >
                      Sorry I don't have. i changed my phone.
                    </p>
                    <p class="small ms-3 mb-3 rounded-3 text-muted">00:13</p>
                  </div>
                </div> -->

                <!-- <div class="d-flex flex-row justify-content-end mb-4 userchatdiv">
                  <div class="userchatmessagediv">
                    <p
                      class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary userchat"
                    >
                      Okay then see you on sunday!!
                    </p>
                  </div>
                  <img
                    src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava4-bg.webp"
                    alt="avatar 1"
                    style="width: 45px; height: 100%"
                  />
                </div> -->
              </div>
              <div
                class="card-footer text-muted d-flex justify-content-start align-items-center p-3"
              >
                <img
                  src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
                  alt="avatar 3"
                  style="width: 40px; height: 100%"
                />
                <input
                  type="text"
                  class="form-control form-control-lg"
                  id="id_message_send_input"
                  placeholder="Action Symbol Qty. Price."
                />

                <button
                  type="button"
                  class="btn btn-primary btn-sm" style="margin-left:10px;"
                  data-mdb-ripple-color="dark" id="id_message_send_button"
                >
                  Send
                </button>
                <!-- <button type="button" name="button" class="btn btn-primary">Send</button> -->
                <a class="ms-1 text-muted" href="#!"
                  ><i class="fas fa-paperclip"></i
                ></a>
                <a class="ms-3 text-muted" href="#!"
                  ><i class="fas fa-smile"></i
                ></a>
                <a class="ms-3" href="#!"><i class="fas fa-paper-plane"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script type="text/javascript">
    var chatbody = document.querySelector('#chatbody');
    chatbody.scrollTop = chatbody.scrollHeight - chatbody.clientHeight;

    const chatSocket = new WebSocket("ws://" + window.location.host + "/ws/socket-server/1234");
  	chatSocket.onopen = function (e) {
  		console.log("The connection was setup successfully !");
  	};
  	chatSocket.onclose = function (e) {
  		console.log("Something unexpected happened !");
  	};
  	document.onkeydown = function (e) {
  		if (e.keyCode == 13) {
  		document.querySelector("#id_message_send_button").click();
  		}
  	};
  	document.querySelector("#id_message_send_button").onclick = function (e) {
  		var messageInput = document.querySelector(
  		"#id_message_send_input"
  		).value;
  		chatSocket.send(JSON.stringify({ message: messageInput, username : "{{request.user.username}}"}));
      document.querySelector('.chatboxdiv').innerHTML += `<div class="d-flex flex-row justify-content-end mb-4 userchatdiv">
        <div class="userchatmessagediv">
          <p
            class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary userchat"
          >
            ${messageInput}
          </p>
        </div>
        <img
          src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava4-bg.webp"
          alt="avatar 1"
          style="width: 45px; height: 100%"
        />
      </div>`
      chatbody.scrollTop = chatbody.scrollHeight - chatbody.clientHeight;
      document.querySelector("#id_message_send_input").value = "";
  	};
  	chatSocket.onmessage = function (e) {
      console.log(e);
  		const data = JSON.parse(e.data);
  		var div = document.createElement("div");
      console.log(data);
      document.querySelector('.chatboxdiv').innerHTML += `
            <div class="d-flex flex-row justify-content-start mb-4 botmessagediv">
        <img
          src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
          alt="avatar 1"
          style="width: 45px; height: 100%"
        />
        <div>
          <p
            class="small p-2 ms-3 mb-1 rounded-3"
            style="background-color: #f5f6f7"
          >
            ${data.bot_message}
          </p>
        </div>
      </div>
      `
      chatbody.scrollTop = chatbody.scrollHeight - chatbody.clientHeight;

  		// document.querySelector(".chatboxdiv").innerHTML += document.querySelector('.userchatdiv').innerHTML
  	};
    </script>
  </body>
</html>
